---
title: "5A: Joins, 5B: "
output: html_notebook
---

Learning joins (part of the {dplyr} package)

left_join() -- with real data
Learn to make a tibble

Back to joins (with made up data as examples)

right_join()
inner_join()
full_join()
semi_join()
anti_join()



```{r}
### load libaries ####
library(tidyverse)
library(here)
library(ggplot2)


```
### Load data ######
```{r}

sites <- read_csv(here("week_05", "data", "site.characteristics.data.csv"))
view(sites)
tpc <-read_csv(here("week_05", "data", "Topt_data.csv"))
glimpse(tpc)
```

site letter links these two data sets together. 

tpc is in wide format, sites is in long 

#1) make site data wider to match tpc

```{r}
sites_wide <- sites %>%
  pivot_wider(names_from = parameter.measured,
              values_from = values)
view(sites_wide)
```

#puts it in alphabetical order-- but to put it in order of site letter 
```{r}
sites_wide <- sites %>%
  pivot_wider(names_from = parameter.measured,
              values_from = values) %>%
  arrange(site.letter) #arrange data frame by site
view(sites_wide)
```

left_join(DATA FRAME ON LEFT, DATA FRAME ON RIGHT)
only retains IDS on the left--- will delete 4 if you use left join 
order really matters with the joins. 

#if you donʻt have any missing values, then all these joins will do the same thing. 


###LEFT JOIN
```{r}
full_left <- left_join(tpc, sites_wide)
view(full_left)
```


###RELOCATE #####

helps to clean data, not going to affect analysis 
#want to look at certain things first or together

```{r}
full_left <- full_left <- left_join(tpc, sites_wide) %>%
  relocate(where(is.numeric), .after = where(is.character))
view(full_left)
```



#CALCULATE MEANS AND VARIANCES OF ALL THE NUMERIC DATA 

My first try: 
```{r}
long <- full_left %>%
  pivot_longer(cols = E:substrate.cover, #columns you want to pivot
               names_to = "Numeric_Variables", #names of new columns with all the variables
               values_to = "Values")  #name of the new column with all the values
long %>%
  group_by(Numeric_Variables, site.letter) %>% #group by everything we want 
  summarise(Param_means = mean(Values, na.rm = TRUE), #get mean
            Param_vars = var(Values, na.rm = TRUE))
```

#SUMMARISE AT
```{r}
full_sum <- full_left %>%
  group_by(site.letter)
  summarize_at(vars(E:Tpot, light:substrate.cover),
               funs(mean = mean, var = var), na.rm = TRUE)
```

#SUMMARISE ACROSS
ANOTHER WAY-- find all the numerics, create a list. mean = mean means that you can call your function mean 
```{r}
full_mean_var <- full_left %>%
  group_by(site.letter) %>%
  summarise(across(where(is.numeric), list(mean = mean, var = var), na.rm = TRUE))
```

SUMMARISE IF
```{r}
summary <- full_left %>%
  select(-site.block)%>%
  group_by(site.letter)%>%
  summarise_if(is.numeric,
               funs(mean=mean, var = var),
               na.rm = TRUE)
```
### DIFFERENT JOINS ####

creating our own tribble 
make 1 tibble: 

```{r}
T1 <- tibble(Site.ID = c("A", "B", "C", "D"),
Temperature = c(14.1, 15.7, 69, 69.1))

T2 <- tibble(Site.ID = c("A", "B", "C", "D"),
pH = c(14, 1, 2, 5))


```

#INNER JOIN
inner join--- if youʻre going to remove nas anyway you can use this -- will reatain ph data

#FULL JOIN
full join--- keeps literally everything, puts NAs in there
(same as merge but itʻs the tidy version)

#SEMI JOIN-- only going to keep data from first data frame
keeps all the rows from the first data set but ONLY where there is matching data in the second one--- find all the sites that expect in T2, but I only want to keep the temperature data. 

If I donʻt actually want to join everything-- I donʻt want stuff that doesnʻt have pH data 

#ANTI JOIN (T1, T2)
saves all the rows in the first data set that donʻt matching anything in the second data set. 

ORDER MATTERS 



###NOTES 5B####
Lubridate date and time

what time is it now? 
```{r}
library(lubridate)
now()
now(tzone = "EST")
now(tzone = "GMT")
```

just the date: 
```{r}
today(tzone = "HST")
am(now()) #is it morning? helpful to divide data 
```

Date specifications for lubridate 
DATES MUST BE CHARACTER FOR IT TO WORK
i.e. put quotes around it 

convert a character string into a date: 
```{r}
ymd("2021/02/24")
```

###GUESSING DATES AND TIME FUNCTIONS-- SINGLE DATES
convert to proper ISO date time
year month day hour minute seconds 
```{r}
ymd_hms("2021-02-24 10:22:20 PM")
mdy_hms("02/24/2021 22:22:20")
mdy_hm("February 24 2021 10:22 PM")

#you have to tell it that every piece is there. i.e. if there are seconds, make sure you include there are seconds 
```


### Extracting specific date or time elements from datetimes

#extract the month from the character string 

```{r}
#make a character string of dates
datetimes <- c("02/24/2021 22:22:20",
               "02/25/2021 11:21:10",
               "02/26/2021 8:01:52")

datetimes <- mdy_hms(datetimes)
month(datetimes, label= TRUE, abb = FALSE) #label makes month a FACTOR, abb makes it spell out month by full so that you can make nice clean plots by spelling out the month 
```

#extract the day or the weekday 

```{r}
day(datetimes)
```

#extract the day of the week
```{r}
wday(datetimes, label = TRUE, abbr = FALSE)
```

#extract specific time elements - hour not HourS
```{r}
hour(datetimes)
minute(datetimes)
second(datetimes)
```

#change date and times -- HourS not hour
```{r}
datetimes + hours(4)
datetimes + days(2)
datetimes + minutes(30)
```
#Round Date times 

```{r}
round_date(datetimes, "minute") #round to nearest minute
```

#round to nearest five (however many) minutes
```{r}
round_date(datetimes, "5 mins") #round to nearest FIVE minutes
```





Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

